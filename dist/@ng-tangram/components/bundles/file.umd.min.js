!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/animations"),require("@angular/cdk/coercion"),require("@angular/core"),require("@angular/forms"),require("@ng-tangram/animate/fading"),require("@ng-tangram/components/forms"),require("@ng-tangram/components/upload"),require("rxjs/operators/takeUntil"),require("rxjs/Subject"),require("@angular/common"),require("@ng-tangram/components/icon"),require("@ng-tangram/components/progress")):"function"==typeof define&&define.amd?define(["exports","@angular/animations","@angular/cdk/coercion","@angular/core","@angular/forms","@ng-tangram/animate/fading","@ng-tangram/components/forms","@ng-tangram/components/upload","rxjs/operators/takeUntil","rxjs/Subject","@angular/common","@ng-tangram/components/icon","@ng-tangram/components/progress"],t):t((e.nt=e.nt||{},e.nt.components=e.nt.components||{},e.nt.components.file={}),e.ng.animations,e.ng.cdk.coercion,e.ng.core,e.ng.forms,e.nt.animate.fading,e.nt.components.forms,e.nt.components.upload,e.Rx.operators.takeUntil,e.Rx.Subject,e.ng.common,e.nt.components.icon,e.nt.components.progress)}(this,function(e,t,n,i,o,r,s,a,l,u,p,c,f){"use strict";var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function m(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var g=0,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id="nt-file-"+g++,t}return m(t,e),t}(a.NtUploadFile),y=function(e){function p(t,n){var o=e.call(this,t,n)||this;return o._destroy=new u.Subject,o._disabled=!1,o._required=!1,o._autoupload=!0,o._value=[],o._maxFiles=1,o._maxSize=5,o._accept=["*"],o.files=[],o.url="",o.name="",o.error=new i.EventEmitter,o.remove=new i.EventEmitter,o}return m(p,e),Object.defineProperty(p.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"required",{get:function(){return this._required},set:function(e){this._required=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"accept",{get:function(){return this._accept},set:function(e){this._accept="string"==typeof e?e.replace(" ","").split(","):n.coerceArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=n.coerceNumberProperty(e,5)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"maxFiles",{get:function(){return this._maxFiles},set:function(e){this._maxFiles=n.coerceNumberProperty(e,1)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"autoupload",{get:function(){return this._autoupload},set:function(e){this._autoupload=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),p.prototype.ngOnInit=function(){},p.prototype.ngOnDestroy=function(){this._destroy.next(),this._destroy.complete(),this.error.complete(),this.remove.complete()},p.prototype.onTriggerClick=function(){this.files.length<this.maxFiles&&this.fileElement.nativeElement.click()},p.prototype._fileChanged=function(){var e=this,t=this.fileElement.nativeElement.files[0];if(t&&this.files.length<this.maxFiles){if(!this._fileSizeValid(t))return void this.error.next(new a.NtFileSizeError(t,1024*this.maxSize*1024,this.maxSize+"MB"));if(!this._fileTypeValid(t))return void this.error.next(new a.NtFileAcceptError(t,t.type));var n=new h(t.name,t.size,t.type);this.files.push(n);var i={begin:function(){return e._onUploadBegin(n)},progress:function(t){return e._onUploadProgress(t,n)},done:function(){return e._onUploadDone(n)}};this.autoupload&&(n.uploader=this._uploader.upload(this.url,this._getFormData(t),i).pipe(l.takeUntil(this._destroy)).subscribe(function(t){(n.status=t.status)===a.NtUploadStatus.SUCCESS&&(n.data=t.data,e._value.push(n),e._onChange(e._value))},function(t){n.status=a.NtUploadStatus.ERROR,n.error=t.statusText,n.progress=100,e.error.next(new a.NtFileUploadError(t.status,t.statusText))}))}this._onTouched&&this._onTouched(),this.fileElement.nativeElement.value=""},p.prototype.removeFile=function(e){if(!this.disabled){e.uploader&&e.uploader.unsubscribe();var t=this._value.indexOf(e);t>-1&&this._value.splice(t,1),this.files.indexOf(e)>-1&&this.files.splice(t,1),this.remove.next(e),this._onChange(this._value)}},p.prototype.setDisabledState=function(e){this._disabled=e},p.prototype.setValue=function(e){var t,n;e&&(this._value.length=0,(t=this._value).push.apply(t,e),this.files.length=0,(n=this.files).push.apply(n,this._value))},p.prototype._fileTypeValid=function(e){return!!e&&(this.accept.indexOf(e.type)>-1||this.accept.indexOf("*")>-1)},p.prototype._fileSizeValid=function(e){return!!e&&e.size<=1024*this.maxSize*1024},p.prototype._onUploadBegin=function(e){e.status=a.NtUploadStatus.SENDING},p.prototype._onUploadProgress=function(e,t){e.total&&e.total>0&&(t.progress=Math.round(e.loaded/e.total*100))},p.prototype._onUploadDone=function(e){e.status=a.NtUploadStatus.SUCCESS},p.decorators=[{type:i.Component,args:[{selector:"nt-file",template:'<button class="button hollow small nt-file-trigger" type="button" (click)="onTriggerClick()" [disabled]="files.length >= maxFiles || disabled"> <ng-content></ng-content> </button> <input #fileElement type="file" [accept]="accept" (change)="_fileChanged()"> <div class="nt-file-item" *ngFor="let file of files" [@fadeOut]> <div class="nt-file-info" [class.success]="file.status === 2" [class.error]="file.status === 3" [class.remote]="file.status === 4"> <nt-ant-icon type="file1"></nt-ant-icon>&nbsp; <a *ngIf="file.link" [href]="file.link" target="_blank">{{file.name}}</a> <ng-container *ngIf="!file.link">{{file.name}}</ng-container> &nbsp;{{ file.size ? \'- \' + (file.size / 1000 / 1000).toFixed(2) + \'MB\' : \'\' }} &nbsp;<span class="nt-file-error" *ngIf="file.error">Error&nbsp;-&nbsp;{{file.error}}</span> <div class="nt-close-button" *ngIf="!disabled" (click)="removeFile(file)"><span aria-hidden="true">&times;</span></div> </div> <nt-progress *ngIf="file.status === 1" [@fadeOut] [class.success]="file.status === 2" [class.alert]="file.status === 3" [value]="file.progress" size="tiny"></nt-progress> </div> \x3c!-- <div class="nt-file-item"> <div class="nt-file-info"> <nt-ant-icon type="file1"></nt-ant-icon>&nbsp;文件0.txt <div class="nt-close-button"><span aria-hidden="true">&times;</span></div> </div> </div> <div class="nt-file-item"> <div class="nt-file-info"> <nt-ant-icon type="file1"></nt-ant-icon>&nbsp;文件1.txt <div class="nt-close-button"><span aria-hidden="true">&times;</span></div> </div> <nt-progress [@fadeOut] color="primary" value="50" size="tiny"></nt-progress> </div> <div class="nt-file-item"> <div class="nt-file-info success"> <nt-ant-icon type="file1"></nt-ant-icon>&nbsp;文件2.txt <div class="nt-close-button"><span aria-hidden="true">&times;</span></div> </div> <nt-progress [@fadeOut] color="success" value="50" size="tiny"></nt-progress> </div> <div class="nt-file-item"> <div class="nt-file-info error"> <nt-ant-icon type="file1"></nt-ant-icon>&nbsp;文件3.txt <div class="nt-close-button"><span aria-hidden="true">&times;</span></div> </div> <nt-progress [@fadeOut] color="alert" value="50" size="tiny"></nt-progress> </div> --\x3e ',host:{class:"nt-form-control nt-file"},encapsulation:i.ViewEncapsulation.None,providers:[{provide:s.NtFormFieldControl,useExisting:p}],animations:[t.trigger("fadeOut",[t.transition("* => void",r.fadeOut(.3))])]}]}],p.ctorParameters=function(){return[{type:a.NtUpload},{type:o.NgControl,decorators:[{type:i.Self},{type:i.Optional}]}]},p.propDecorators={url:[{type:i.Input}],name:[{type:i.Input}],disabled:[{type:i.Input}],required:[{type:i.Input}],accept:[{type:i.Input}],maxSize:[{type:i.Input}],maxFiles:[{type:i.Input}],autoupload:[{type:i.Input}],fileElement:[{type:i.ViewChild,args:["fileElement"]}],error:[{type:i.Output}],remove:[{type:i.Output}]},p}(a.NtUploadControl),v=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[p.CommonModule,a.NtUploadModule,f.NtProgressModule,c.NtIconModule],exports:[y],declarations:[y]}]}],e.ctorParameters=function(){return[]},e}();e.NtFileModule=v,e.NtFile=h,e.NtFileComponent=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=file.umd.min.js.map
