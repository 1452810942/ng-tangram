!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/animations"),require("@angular/cdk/coercion"),require("@angular/core"),require("@angular/forms"),require("@ng-tangram/animate/fading"),require("@ng-tangram/components/forms"),require("@ng-tangram/components/modal"),require("@ng-tangram/components/upload"),require("rxjs/operators"),require("rxjs/Subject"),require("@angular/common"),require("@ng-tangram/components/icon"),require("@ng-tangram/components/progress")):"function"==typeof define&&define.amd?define(["exports","@angular/animations","@angular/cdk/coercion","@angular/core","@angular/forms","@ng-tangram/animate/fading","@ng-tangram/components/forms","@ng-tangram/components/modal","@ng-tangram/components/upload","rxjs/operators","rxjs/Subject","@angular/common","@ng-tangram/components/icon","@ng-tangram/components/progress"],t):t((e.nt=e.nt||{},e.nt.components=e.nt.components||{},e.nt.components.picture={}),e.ng.animations,e.ng.cdk.coercion,e.ng.core,e.ng.forms,e.nt.animate.fading,e.nt.components.forms,e.nt.components.modal,e.nt.components.upload,e.Rx.operators,e.Rx.Subject,e.ng.common,e.nt.components.icon,e.nt.components.progress)}(this,function(e,t,n,i,o,r,a,s,l,u,c,d,f,p){"use strict";var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function h(e,t){function n(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function m(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(e,t){return e(t={exports:{}},t.exports),t.exports}var v=b(function(e){!function(t){function n(e,t,i){var o,r=document.createElement("img");return r.onerror=function(o){return n.onerror(r,o,e,t,i)},r.onload=function(o){return n.onload(r,o,e,t,i)},"string"==typeof e?(n.fetchBlob(e,function(t){t?(e=t,o=n.createObjectURL(e)):(o=e,i&&i.crossOrigin&&(r.crossOrigin=i.crossOrigin)),r.src=o},i),r):n.isInstanceOf("Blob",e)||n.isInstanceOf("File",e)?(o=r._objectURL=n.createObjectURL(e))?(r.src=o,r):n.readFile(e,function(e){var n=e.target;n&&n.result?r.src=n.result:t&&t(e)}):void 0}var i=t.createObjectURL&&t||t.URL&&URL.revokeObjectURL&&URL||t.webkitURL&&webkitURL;function o(e,t){!e._objectURL||t&&t.noRevoke||(n.revokeObjectURL(e._objectURL),delete e._objectURL)}n.fetchBlob=function(e,t,n){t()},n.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},n.transform=function(e,t,n,i,o){n(e,o)},n.onerror=function(e,t,n,i,r){o(e,r),i&&i.call(e,t)},n.onload=function(e,t,i,r,a){o(e,a),r&&n.transform(e,a,r,i,{})},n.createObjectURL=function(e){return!!i&&i.createObjectURL(e)},n.revokeObjectURL=function(e){return!!i&&i.revokeObjectURL(e)},n.readFile=function(e,n,i){if(t.FileReader){var o=new FileReader;if(o.onload=o.onerror=n,o[i=i||"readAsDataURL"])return o[i](e),o}return!1},e.exports?e.exports=n:t.loadImage=n}("undefined"!=typeof window&&window||y)}),S=(b(function(e){var t;t=function(e){var t=e.transform;e.transform=function(n,i,o,r,a){t.call(e,e.scale(n,i,a),i,o,r,a)},e.transformCoordinates=function(){},e.getTransformedOptions=function(e,t){var n,i,o,r,a=t.aspectRatio;if(!a)return t;for(i in n={},t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n.crop=!0,(o=e.naturalWidth||e.width)/(r=e.naturalHeight||e.height)>a?(n.maxWidth=r*a,n.maxHeight=r):(n.maxWidth=o,n.maxHeight=o/a),n},e.renderImageToCanvas=function(e,t,n,i,o,r,a,s,l,u){return e.getContext("2d").drawImage(t,n,i,o,r,a,s,l,u),e},e.hasCanvasOption=function(e){return e.canvas||e.crop||!!e.aspectRatio},e.scale=function(t,n,i){n=n||{};var o,r,a,s,l,u,c,d,f,p,g,h=document.createElement("canvas"),m=t.getContext||e.hasCanvasOption(n)&&h.getContext,y=t.naturalWidth||t.width,b=t.naturalHeight||t.height,v=y,S=b;function x(){var e=Math.max((a||v)/v,(s||S)/S);e>1&&(v*=e,S*=e)}function w(){var e=Math.min((o||v)/v,(r||S)/S);e<1&&(v*=e,S*=e)}if(m&&(c=(n=e.getTransformedOptions(t,n,i)).left||0,d=n.top||0,n.sourceWidth?(l=n.sourceWidth,void 0!==n.right&&void 0===n.left&&(c=y-l-n.right)):l=y-c-(n.right||0),n.sourceHeight?(u=n.sourceHeight,void 0!==n.bottom&&void 0===n.top&&(d=b-u-n.bottom)):u=b-d-(n.bottom||0),v=l,S=u),o=n.maxWidth,r=n.maxHeight,a=n.minWidth,s=n.minHeight,m&&o&&r&&n.crop?(v=o,S=r,(g=l/u-o/r)<0?(u=r*l/o,void 0===n.top&&void 0===n.bottom&&(d=(b-u)/2)):g>0&&(l=o*u/r,void 0===n.left&&void 0===n.right&&(c=(y-l)/2))):((n.contain||n.cover)&&(a=o=o||a,s=r=r||s),n.cover?(w(),x()):(x(),w())),m){if((f=n.pixelRatio)>1&&(h.style.width=v+"px",h.style.height=S+"px",v*=f,S*=f,h.getContext("2d").scale(f,f)),(p=n.downsamplingRatio)>0&&p<1&&v<l&&S<u)for(;l*p>v;)h.width=l*p,h.height=u*p,e.renderImageToCanvas(h,t,c,d,l,u,0,0,h.width,h.height),c=0,d=0,l=h.width,u=h.height,(t=document.createElement("canvas")).width=l,t.height=u,e.renderImageToCanvas(t,h,0,0,l,u,0,0,l,u);return h.width=v,h.height=S,e.transformCoordinates(h,n),e.renderImageToCanvas(h,t,c,d,l,u,0,0,v,S)}return t.width=v,t.height=S,t}},e.exports?t(v):t(window.loadImage)}),b(function(e){var t;t=function(e){var t="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=t&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},e.metaDataParsers={jpeg:{65505:[]}},e.parseMetaData=function(t,n,i,o){i=i||{},o=o||{};var r=this,a=i.maxMetaDataSize||262144;!!("undefined"!=typeof DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&e.blobSlice)&&e.readFile(e.blobSlice.call(t,0,a),function(t){if(t.target.error)return console.log(t.target.error),void n(o);var a,s,l,u,c=t.target.result,d=new DataView(c),f=2,p=d.byteLength-4,g=f;if(65496===d.getUint16(0)){for(;f<p&&((a=d.getUint16(f))>=65504&&a<=65519||65534===a);){if(f+(s=d.getUint16(f+2)+2)>d.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(l=e.metaDataParsers.jpeg[a])for(u=0;u<l.length;u+=1)l[u].call(r,d,f,s,o,i);g=f+=s}!i.disableImageHead&&g>6&&(c.slice?o.imageHead=c.slice(0,g):o.imageHead=new Uint8Array(c).subarray(0,g))}else console.log("Invalid JPEG file: Missing JPEG marker.");n(o)},"readAsArrayBuffer")||n(o)},e.hasMetaOption=function(e){return e&&e.meta};var n=e.transform;e.transform=function(t,i,o,r,a){e.hasMetaOption(i)?e.parseMetaData(r,function(a){n.call(e,t,i,o,r,a)},i,a):n.apply(e,arguments)}},e.exports?t(v):t(window.loadImage)}),b(function(e){var t;t=function(e){"undefined"!=typeof fetch&&"undefined"!=typeof Request&&(e.fetchBlob=function(t,n,i){if(e.hasMetaOption(i))return fetch(new Request(t,i)).then(function(e){return e.blob()}).then(n).catch(function(e){console.log(e),n()});n()})},e.exports?t(v):t(window.loadImage)}),b(function(e){var t;t=function(e){e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(t,n,i){if(i&&!(n+i>t.byteLength))return e.createObjectURL(new Blob([t.buffer.slice(n,n+i)]));console.log("Invalid Exif data: Invalid thumbnail data.")},e.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,n){return e.getUint16(t,n)},size:2},4:{getValue:function(e,t,n){return e.getUint32(t,n)},size:4},5:{getValue:function(e,t,n){return e.getUint32(t,n)/e.getUint32(t+4,n)},size:8},9:{getValue:function(e,t,n){return e.getInt32(t,n)},size:4},10:{getValue:function(e,t,n){return e.getInt32(t,n)/e.getInt32(t+4,n)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(t,n,i,o,r,a){var s,l,u,c,d,f,p=e.exifTagTypes[o];if(p){if(!((l=(s=p.size*r)>4?n+t.getUint32(i+8,a):i+8)+s>t.byteLength)){if(1===r)return p.getValue(t,l,a);for(u=[],c=0;c<r;c+=1)u[c]=p.getValue(t,l+c*p.size,a);if(p.ascii){for(d="",c=0;c<u.length&&"\0"!==(f=u[c]);c+=1)d+=f;return d}return u}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},e.parseExifTag=function(t,n,i,o,r){var a=t.getUint16(i,o);r.exif[a]=e.getExifValue(t,n,i,t.getUint16(i+2,o),t.getUint32(i+4,o),o)},e.parseExifTags=function(e,t,n,i,o){var r,a,s;if(n+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((a=n+2+12*(r=e.getUint16(n,i)))+4>e.byteLength)){for(s=0;s<r;s+=1)this.parseExifTag(e,t,n+2+12*s,i,o);return e.getUint32(a,i)}console.log("Invalid Exif data: Invalid directory size.")}},e.parseExifData=function(t,n,i,o,r){if(!r.disableExif){var a,s,l,u=n+10;if(1165519206===t.getUint32(n+4))if(u+8>t.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===t.getUint16(n+8)){switch(t.getUint16(u)){case 18761:a=!0;break;case 19789:a=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===t.getUint16(u+2,a)?(s=t.getUint32(u+4,a),o.exif=new e.ExifMap,(s=e.parseExifTags(t,u,u+s,a,o))&&!r.disableExifThumbnail&&(l={exif:{}},s=e.parseExifTags(t,u,u+s,a,l),l.exif[513]&&(o.exif.Thumbnail=e.getExifThumbnail(t,u+l.exif[513],l.exif[514]))),o.exif[34665]&&!r.disableExifSub&&e.parseExifTags(t,u,u+o.exif[34665],a,o),o.exif[34853]&&!r.disableExifGps&&e.parseExifTags(t,u,u+o.exif[34853],a,o)):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},e.metaDataParsers.jpeg[65505].push(e.parseExifData)},e.exports?t(v):t(window.loadImage)}),b(function(e){var t;t=function(e){e.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},e.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},e.ExifMap.prototype.getText=function(e){var t=this.get(e);switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[e][t];case"ExifVersion":case"FlashpixVersion":if(!t)return;return String.fromCharCode(t[0],t[1],t[2],t[3]);case"ComponentsConfiguration":if(!t)return;return this.stringValues[e][t[0]]+this.stringValues[e][t[1]]+this.stringValues[e][t[2]]+this.stringValues[e][t[3]];case"GPSVersionID":if(!t)return;return t[0]+"."+t[1]+"."+t[2]+"."+t[3]}return String(t)},function(e){var t,n=e.tags,i=e.map;for(t in n)n.hasOwnProperty(t)&&(i[n[t]]=t)}(e.ExifMap.prototype),e.ExifMap.prototype.getAll=function(){var e,t,n={};for(e in this)this.hasOwnProperty(e)&&(t=this.tags[e])&&(n[t]=this.getText(t));return n}},e.exports?t(v):t(window.loadImage)}),b(function(e){var t;t=function(e){var t=e.hasCanvasOption,n=e.hasMetaOption,i=e.transformCoordinates,o=e.getTransformedOptions;e.hasCanvasOption=function(n){return!!n.orientation||t.call(e,n)},e.hasMetaOption=function(t){return t&&!0===t.orientation||n.call(e,t)},e.transformCoordinates=function(t,n){i.call(e,t,n);var o=t.getContext("2d"),r=t.width,a=t.height,s=t.style.width,l=t.style.height,u=n.orientation;if(u&&!(u>8))switch(u>4&&(t.width=a,t.height=r,t.style.width=l,t.style.height=s),u){case 2:o.translate(r,0),o.scale(-1,1);break;case 3:o.translate(r,a),o.rotate(Math.PI);break;case 4:o.translate(0,a),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-a);break;case 7:o.rotate(.5*Math.PI),o.translate(r,-a),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-r,0)}},e.getTransformedOptions=function(t,n,i){var r,a,s=o.call(e,t,n),l=s.orientation;if(!0===l&&i&&i.exif&&(l=i.exif.get("Orientation")),!l||l>8||1===l)return s;for(a in r={},s)s.hasOwnProperty(a)&&(r[a]=s[a]);switch(r.orientation=l,l){case 2:r.left=s.right,r.right=s.left;break;case 3:r.left=s.right,r.top=s.bottom,r.right=s.left,r.bottom=s.top;break;case 4:r.top=s.bottom,r.bottom=s.top;break;case 5:r.left=s.top,r.top=s.left,r.right=s.bottom,r.bottom=s.right;break;case 6:r.left=s.top,r.top=s.right,r.right=s.bottom,r.bottom=s.left;break;case 7:r.left=s.bottom,r.top=s.right,r.right=s.top,r.bottom=s.left;break;case 8:r.left=s.bottom,r.top=s.left,r.right=s.top,r.bottom=s.right}return r.orientation>4&&(r.maxWidth=s.maxHeight,r.maxHeight=s.maxWidth,r.minWidth=s.minHeight,r.minHeight=s.minWidth,r.sourceWidth=s.sourceHeight,r.sourceHeight=s.sourceWidth),r}},e.exports?t(v):t(window.loadImage)}),v);function x(e,t){return new Promise(function(n,i){S(e,function(e){e.toBlob?e.toBlob(function(t){var i=e.toDataURL("image/png");t.lastModifiedDate=new Date,t.lastModified=t.lastModifiedDate.getTime(),n({thumbnail:i,blob:t})}):i("HTMLCanvasElement toBlob function is undefined")},t)})}var w=0,P=["image/jpeg","image/jpg","image/png","image/gif","image/bmp"],C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id="nt-picture-"+w++,t}return h(t,e),t}(l.NtUploadFile),I=function(e){function d(t,n,o){var r=e.call(this,n,o)||this;return r._modal=t,r._destroy=new c.Subject,r._disabled=!1,r._required=!1,r._autoupload=!0,r._value=[],r._maxFiles=1,r._maxSize=5,r._accept=P,r.files=[],r.url="",r.name="",r.error=new i.EventEmitter,r.remove=new i.EventEmitter,r}return h(d,e),Object.defineProperty(d.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"required",{get:function(){return this._required},set:function(e){this._required=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"accept",{get:function(){return this._accept},set:function(e){this._accept="string"==typeof e?"*"===e?P:e.replace(" ","").split(",").filter(function(e){return P.indexOf(e)>-1}):n.coerceArray(e).filter(function(e){return P.indexOf(e)>-1})},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=n.coerceNumberProperty(e,5)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"maxFiles",{get:function(){return this._maxFiles},set:function(e){this._maxFiles=n.coerceNumberProperty(e,1)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"autoupload",{get:function(){return this._autoupload},set:function(e){this._autoupload=n.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),d.prototype.ngOnInit=function(){},d.prototype.ngOnDestroy=function(){this._destroy.next(),this._destroy.complete(),this.error.complete(),this.remove.complete()},d.prototype.onTriggerClick=function(){this.files.length<this.maxFiles&&this.fileElement.nativeElement.click()},d.prototype._fileChanged=function(){return e=this,t=void 0,i=function(){var e,t,n,i,o=this;return m(this,function(r){switch(r.label){case 0:return(e=this.fileElement.nativeElement.files[0])&&this.files.length<this.maxFiles?this._fileSizeValid(e)?this._fileTypeValid(e)?(t=new C(e.name,e.size,e.type),[4,x(e,{maxWidth:1080,orientation:!0,canvas:!0})]):(this.error.next(new l.NtFileAcceptError(e,e.type)),[2]):(this.error.next(new l.NtFileSizeError(e,1024*this.maxSize*1024,this.maxSize+"MB")),[2]):[3,2];case 1:n=r.sent(),t.thumbnail=n.thumbnail,this.files.push(t),i={begin:function(){return o._onUploadBegin(t)},progress:function(e){return o._onUploadProgress(e,t)},done:function(){return o._onUploadDone(t)}},this.autoupload&&(t.uploader=this._uploader.upload(this.url,this._getFormData(e),i).pipe(u.takeUntil(this._destroy)).subscribe(function(e){(t.status=e.status)===l.NtUploadStatus.SUCCESS&&(t.data=e.data,o._value.push(t),o._onChange(o._value))},function(e){t.status=l.NtUploadStatus.ERROR,t.error=e.statusText,t.progress=100,o.error.next(new l.NtFileUploadError(e.status,e.statusText))})),r.label=2;case 2:return this._onTouched&&this._onTouched(),this.fileElement.nativeElement.value="",[2]}})},new((n=void 0)||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())});var e,t,n,i},d.prototype.removeFile=function(e){if(!this.disabled){e.uploader&&e.uploader.unsubscribe();var t=this._value.indexOf(e);t>-1&&this._value.splice(t,1),this.files.indexOf(e)>-1&&this.files.splice(t,1),this.remove.next(e),this._onChange(this._value)}},d.prototype.preview=function(e){this._modal.open(this.previewTemplate,{data:e,centerVertically:!0,maxWidth:"90vw",maxHeight:"90vh"})},d.prototype.setDisabledState=function(e){this._disabled=e},d.prototype.setValue=function(e){var t,n;e&&(this._value.length=0,(t=this._value).push.apply(t,e),this.files.length=0,(n=this.files).push.apply(n,this._value))},d.prototype._fileTypeValid=function(e){return!!e&&(this.accept.indexOf(e.type)>-1||this.accept.indexOf("*")>-1)},d.prototype._fileSizeValid=function(e){return!!e&&e.size<=1024*this.maxSize*1024},d.prototype._onUploadBegin=function(e){e.status=l.NtUploadStatus.SENDING},d.prototype._onUploadProgress=function(e,t){e.total&&e.total>0&&(t.progress=Math.round(e.loaded/e.total*100))},d.prototype._onUploadDone=function(e){e.status=l.NtUploadStatus.SUCCESS},d.decorators=[{type:i.Component,args:[{selector:"nt-picture",template:'<input #fileElement type="file" [accept]="accept" (change)="_fileChanged()"> <div class="nt-picture-item" *ngFor="let file of files" [style.backgroundImage]="\'url(\' + file.thumbnail + \')\'"> <div class="nt-picture-action" *ngIf="file.status >= 2 && !disabled"> <nt-ant-icon type="search1" (click)="preview(file)"></nt-ant-icon> <nt-ant-icon type="delete" (click)="removeFile(file)"></nt-ant-icon> </div> <div class="nt-picture-progress" *ngIf="file.status === 1" [@fadeOut]> <nt-progress *ngIf="file.status === 1" [value]="file.progress" size="tiny" color="success"></nt-progress> </div> </div> <div class="nt-picture-add" (click)="onTriggerClick()" *ngIf="this.files.length < maxFiles && !disabled"> <nt-ant-icon type="plus"></nt-ant-icon> </div> <ng-template #previewTemplate let-data> <div class="nt-picture-preview"> <img [src]="data.link || data.thumbnail"> </div> </ng-template> ',host:{class:"nt-form-control nt-picture"},encapsulation:i.ViewEncapsulation.None,providers:[{provide:a.NtFormFieldControl,useExisting:d}],animations:[t.trigger("fade",[t.transition("* => void",r.fadeOut(.3)),t.transition("void => *",r.fadeIn(.3))]),t.trigger("fadeOut",[t.transition("* => void",r.fadeOut(.3))])]}]}],d.ctorParameters=function(){return[{type:s.NtModal},{type:l.NtUpload},{type:o.NgControl,decorators:[{type:i.Self},{type:i.Optional}]}]},d.propDecorators={url:[{type:i.Input}],name:[{type:i.Input}],disabled:[{type:i.Input}],required:[{type:i.Input}],accept:[{type:i.Input}],maxSize:[{type:i.Input}],maxFiles:[{type:i.Input}],autoupload:[{type:i.Input}],fileElement:[{type:i.ViewChild,args:["fileElement"]}],previewTemplate:[{type:i.ViewChild,args:["previewTemplate"]}],error:[{type:i.Output}],remove:[{type:i.Output}]},d}(l.NtUploadControl),O=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[d.CommonModule,s.NtModalModule,l.NtUploadModule,p.NtProgressModule,f.NtIconModule],exports:[I],declarations:[I]}]}],e.ctorParameters=function(){return[]},e}();e.NtPictureModule=O,e.zipToImage=x,e.NtPictureAccepts=P,e.NtPicture=C,e.NtPictureComponent=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=picture.umd.min.js.map
